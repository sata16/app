{% extends "base.html" %}
{% block title %}{% if is_edit %}–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ{% else %}–°–æ–∑–¥–∞—Ç—å –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ{% endif %}{% endblock %}

{% block content %}
<section class="tenant-profile">

  <h2>
    {% if is_edit %}
      –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ
    {% else %}
      –°–æ–∑–¥–∞—Ç—å –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ
    {% endif %}
  </h2>

  <form method="POST" action="{{ url_for('workspace.client_card', client_id=client.client_id if client else 0) }}">
    <input type="hidden" name="action" value="create_booking">

    <!-- === –ü–∞—Ä–∫–æ–≤–æ—á–Ω–æ–µ –º–µ—Å—Ç–æ === -->
    <div class="form-group">
      <label for="spot_id">–ü–∞—Ä–∫–æ–≤–æ—á–Ω–æ–µ –º–µ—Å—Ç–æ</label>
      <select id="spot_id" name="spot_id" required>
        {% for s in spots_list %}
          <option value="{{ s.spot_id }}"
            {% if pre_spot_id == s.spot_id %}selected{% endif %}>
            ‚Ññ{{ s.number }} ({{ s.parking.address if s.parking else '‚Äî' }})
          </option>
        {% endfor %}
      </select>
    </div>

    <!-- === –ê—Ä–µ–Ω–¥–∞—Ç–æ—Ä === -->
    <div class="form-group">
      <label for="existing_client_id">–§–ò–û –∞—Ä–µ–Ω–¥–∞—Ç–æ—Ä–∞</label>
      <select id="existing_client_id" name="existing_client_id" onchange="fillClientContact(this)">
        <option value="">‚Äî –í—ã–±–µ—Ä–∏—Ç–µ –∞—Ä–µ–Ω–¥–∞—Ç–æ—Ä–∞ ‚Äî</option>

        {% for c in clients_list %}
          <option value="{{ c.client_id }}"
                  data-phone="{{ c.phone or '' }}"
                  {% if client and c.client_id == client.client_id %}selected{% endif %}>
              {{ c.name }}
          </option>
        {% endfor %}
      </select>
    </div>

    <div class="form-group">
      <label for="phone">–¢–µ–ª–µ—Ñ–æ–Ω</label>
      <input id="phone" name="phone" type="text"
             value="{{ client.phone if client else '' }}"
             placeholder="+7..." />
    </div>

    <!-- === –ü–µ—Ä–∏–æ–¥ + –°—É–º–º–∞ –Ω–∞—á–∏—Å–ª–µ–Ω–∏—è === -->
    <div class="form-row">
      <div class="form-col">
        <label>–ü–µ—Ä–∏–æ–¥ –Ω–∞—á–∏—Å–ª–µ–Ω–∏—è</label>
        <div class="pair">
          <input type="date" id="start_date" name="start_date"
                 value="{{ pre_start }}" required>
          <span class="dash">‚Äî</span>
          <input type="date" id="end_date" name="end_date"
                 value="{{ pre_end }}" required>
        </div>
      </div>

      <div class="form-col">
        <label for="rent_size">–°—É–º–º–∞ –Ω–∞—á–∏—Å–ª–µ–Ω–∏—è (‚ÇΩ)</label>
        <input id="rent_size" name="rent_size" type="number" step="0.01"
               value="{{ pre_rent }}" required>
      </div>
    </div>

    <!-- === –û–ø–ª–∞—Ç–∞ === -->
    <div class="form-row">
      <div class="form-col">
        <label for="payment_date">–î–∞—Ç–∞ –æ–ø–ª–∞—Ç—ã</label>
        <input id="payment_date" name="payment_date" type="date"
               value="{{ pre_payment_date }}">
      </div>

      <div class="form-col">
        <label for="payment_amount">–°—É–º–º–∞ –æ–ø–ª–∞—Ç—ã (‚ÇΩ)</label>
        <input id="payment_amount" name="payment_amount" type="number"
               step="0.01" value="{{ pre_payment_amount }}">
      </div>
    </div>

    <!-- === –ü—Ä–∏–º–µ—á–∞–Ω–∏–µ === -->
    <div class="form-group">
      <label for="notes">–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ</label>
      <textarea id="notes" name="notes" rows="3"
                placeholder="–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è...">{{ pre_notes }}</textarea>
    </div>

    <!-- === –ö–Ω–æ–ø–∫–∏ === -->
    <div class="buttons-container">
      <button type="submit" class="btn">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
      <a href="{{ url_for('workspace.view') }}" class="btn btn-secondary">‚Üê –ù–∞–∑–∞–¥</a>
    </div>

  </form>
</section>

<script>
function fillClientContact(sel) {
  const opt = sel.options[sel.selectedIndex];
  const phone = opt.getAttribute('data-phone') || '';
  document.getElementById('phone').value = phone;
}
</script>

{% endblock %}